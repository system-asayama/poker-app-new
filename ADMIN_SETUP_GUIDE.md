# 初期システム管理者設定ガイド

## 概要

このガイドでは、テキサスホールデムポーカーゲームの**初期システム管理者**を設定する方法を説明します。

---

## 初期管理者設定機能について

**初期管理者設定機能**は、最初のシステム管理者を安全に設定するための機能です。この機能には以下の特徴があります：

✅ **マスターパスワード認証**: 事前に設定されたマスターパスワードが必要  
✅ **一度のみ有効**: 既に管理者が存在する場合は使用不可  
✅ **ログイン必須**: 通常のユーザーアカウントでログイン後に使用可能  
✅ **自動昇格**: マスターパスワードが正しければ、そのユーザーを管理者に昇格

---

## 初期管理者の設定手順

### ステップ1: アカウントを作成

1. アプリにアクセス: https://poker-app-new-53688fe543c9.herokuapp.com/
2. ログインページで「アカウントを作成」をクリック
3. メールアドレス、ユーザー名、パスワードを入力して登録

### ステップ2: 初期管理者設定ページにアクセス

1. ログイン後、以下のURLに直接アクセス:  
   **https://poker-app-new-53688fe543c9.herokuapp.com/setup-admin**

   または、ログインページの下部にある「初期管理者設定」リンクをクリック

### ステップ3: マスターパスワードを入力

1. 初期管理者設定ページで、マスターパスワードを入力
2. 「管理者として設定」ボタンをクリック
3. 成功すると、自動的に管理者権限が付与されます

### ステップ4: 管理者ログインで確認

1. 管理者ログインページにアクセス:  
   **https://poker-app-new-53688fe543c9.herokuapp.com/admin-login**
2. 先ほど作成したアカウントでログイン
3. 管理画面（/admin）にリダイレクトされれば成功

---

## マスターパスワード

**デフォルトのマスターパスワード**: `admin-n-N31415926!!`

> **セキュリティ上の注意**:  
> マスターパスワードは環境変数`MASTER_PASSWORD`で変更できます。  
> Herokuの設定画面で環境変数を追加してください。

```bash
heroku config:set MASTER_PASSWORD="your-new-password" --app poker-app-new
```

---

## トラブルシューティング

### エラー: "Invalid master password"

- マスターパスワードが間違っています
- 正しいマスターパスワードを入力してください

### エラー: "An admin already exists"

- 既に管理者が存在しています
- 既存の管理者に連絡して、ユーザー管理画面から権限を付与してもらってください

### エラー: "User not found"

- ログインしていない可能性があります
- 一度ログアウトして、再度ログインしてから試してください

---

## 管理者の権限

初期管理者として設定されると、以下の機能が利用可能になります：

### 1. **ユーザー管理**（/users）
- 全ユーザーの一覧表示
- ユーザーの権限変更（プレイヤー ⇔ 管理者）
- ユーザーの削除

### 2. **ゲーム監視**（/admin）
- 全プレイヤーのカードをリアルタイム表示
- デッキの次のカードをプレビュー
- アクション履歴の確認

### 3. **プライベートルーム作成**
- 招待制のゲームルームを作成
- 特定のユーザーのみ参加可能

---

## セキュリティのベストプラクティス

1. **マスターパスワードの変更**: デフォルトのマスターパスワードは必ず変更してください
2. **管理者の最小化**: 必要最小限の管理者のみに権限を付与してください
3. **定期的な監査**: ユーザー管理画面で定期的に管理者リストを確認してください
4. **ログの確認**: 不審なアクティビティがないか定期的に確認してください

---

## 追加の管理者を作成する方法

初期管理者が設定された後、追加の管理者は以下の手順で作成できます：

1. 管理者アカウントでログイン
2. 管理画面（/admin）にアクセス
3. 「ユーザー管理」ボタンをクリック
4. ユーザー一覧から昇格させたいユーザーを選択
5. 「管理者に昇格」ボタンをクリック

---

## 関連ドキュメント

- **README.md**: プロジェクト全体の概要
- **DEPLOYMENT.md**: デプロイ情報とトラブルシューティング
- **NEW_FEATURES.md**: 新機能の詳細説明

---

## サポート

問題が発生した場合は、GitHubのIssuesページでご報告ください:  
https://github.com/system-asayama/poker-app-new/issues
